/*
* Fancy Product Designer - jQuery plugin 2.0.6 
* Copyright 2013, Rafael Dery
*
* Only for the sale at the envato marketplaces
*/
!function(a){var b=function(b,c){var d=a.extend({},a.fn.fancyProductDesigner.defaults,c);d.labels=a.extend({},a.fn.fancyProductDesigner.defaults.labels,d.labels),d.labels.modificationTooltips=a.extend({},a.fn.fancyProductDesigner.defaults.labels.modificationTooltips,d.labels.modificationTooltips),d.labels.colorpicker=a.extend({},a.fn.fancyProductDesigner.defaults.labels.colorpicker,d.labels.colorpicker),d.customImagesParameters=void 0==d.uploadedDesignsParameters?d.customImagesParameters:d.uploadedDesignsParameters,d.customImagesParameters=a.extend({},a.fn.fancyProductDesigner.defaults.customImagesParameters,d.customImagesParameters),d.dimensions=a.extend({},a.fn.fancyProductDesigner.defaults.dimensions,d.dimensions);var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w=this,x=null,y=null,z=0,A=-1,B=null,C=0,D=null,E=null,F=0,G={},H=new Image,I=new Image;H.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QkNGMzVGRDE0NENBMTFFMzlDNTlBQzY1MzlBMkNBNzMiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QkNGMzVGRDI0NENBMTFFMzlDNTlBQzY1MzlBMkNBNzMiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpCQ0YzNUZDRjQ0Q0ExMUUzOUM1OUFDNjUzOUEyQ0E3MyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpCQ0YzNUZEMDQ0Q0ExMUUzOUM1OUFDNjUzOUEyQ0E3MyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pj80kqoAAAHdSURBVHjalFO7agJREB2Xa6Hio1CIEbSIKIidptJOENJYCraBlGnyCX5BiF8gCUEhWClYhQULIaRUFlQEX4VKCp/gczJ3yW5iYsLmwHL3vs7MnDmX1Wo1IJyYTKYrvV5/hgT4AzqdTtjtdm+LxeJxv9+/AhE4x+PxC03wP5jP52NJkqLMaDRe2u328++RVqsV9Ho9oGhgsVjA6XQe7FPGdqvVegPdbjfzlXk6nWI6nUa/349UEgqCgDabDePxOJbLZflMoVDAVquFk8lEhE6nc6tcpn8MhUJcg1+/ZDKJZrMZ6/U6L+NZJaCUMRKJqAcZYxiLxTCVSqHP5/tB1Gw2cTabfRJks1l10+12Y6VSUcvabreYSCQOCBqNhkzAqC2yKLlcTmkTZDIZiEajqmClUgmq1SqQHvJcGTkYn1ALod1uywsulwtIsAPFA4EAiKKoXuRBPB4PkODAjhgFlKwUeL3eo6binhN4dM5MdcuLg8EAqF2gFYLiXGqPPHLCfD6vmYB34Y4rvVwuMRgMYjgcxuFwqMnOo9FIZDTOOJHBYIBisQhkbXA4HJqC87gCvaoH6ueQL3BltV7ebDZAVr7nGUj9fv+CHsY1ue/0wyh/vmjSaU5Bc+v1+uldgAEAQbiBjYjV1d0AAAAASUVORK5CYII=",I.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6RkY3RjhCMTI0NENEMTFFMzlDNTlBQzY1MzlBMkNBNzMiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6RkY3RjhCMTM0NENEMTFFMzlDNTlBQzY1MzlBMkNBNzMiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpCQ0YzNUZENzQ0Q0ExMUUzOUM1OUFDNjUzOUEyQ0E3MyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpCQ0YzNUZEODQ0Q0ExMUUzOUM1OUFDNjUzOUEyQ0E3MyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pj7soO0AAAG9SURBVHjalFM9awJBEJ07TwstlPMKL4WFVlEsU5lGEMHKQizSSSBlmoA/wH+QP2AlhBSptLESBCtJIyqCH6BgETwFNeeBH+dmdskdhiR3yYMtdnf2zbw3s1y32wVEwOPx3DmdzjBBgAU4juN1XV9ut9un0+n0CkggK4rSIv8APiSqqir9fv9acLvdt5IkXU0mE2g0GsDzPOz3e/D5fJDJZEAQhJ+qAKxYwpgHvBcC9LDZbEI+n2cBsixDuVwGh8NhpYaSizxWpNONy+UyL7AiiEajLJMVqBre2GiaBsFgENLpNHQ6HYjH49But8EOJoEoilAqlaBarUIymYTpdArL5dKWgAY+Gs4aWCwWpNWyb8x8Pq8L584a8Pv9bJ0DE7AO/SrBCrVaDRKJBIxGI7Yfj8es1SypIcFqaHK5HJ1OEolESKVSIalUiux2O4Ie1W0JKFarFclms4yErnCYTTwj4P8iw+v1QqFQMAcL/4JpgYBE73YEw+EQisUixGIxOjwQCoUMYzXo9XqXm83mzUrC4XAgx+PxyxmaSAaDwQ2toD+bzdJY5j3O9sWnzm+f56zNHGZW1+v1M5K8fAgwAKZZlVqllD6aAAAAAElFTkSuQmCC",f=a(b).addClass("fpd-container fpd-clearfix fpd-"+d.layout).before('<p class="fpd-initiliazing">'+d.labels.initText+"</p>"),r=f.children(".fpd-product").remove(),s=f.children(".fpd-design"),("icon-sb-top"==d.layout||"icon-sb-bottom"==d.layout)&&f.addClass("fpd-horizontal");var J=document.createElement("canvas"),K=Boolean(J.getContext&&J.getContext("2d"));if(!K)return a.post(d.templatesDirectory+"canvaserror.php",function(b){f.append(a.parseHTML(b)),f.trigger("templateLoad",[this.url])}),f.trigger("canvasFail"),!1;window.localStorage.length;var L;a.post(d.templatesDirectory+"sidebar.php",function(b){L=b,f.trigger("templateLoad",[this.url]),a.post(d.templatesDirectory+"productstage.php",function(b){f.prev(".fpd-initiliazing").remove(),"icon-sb-left"==d.layout||"icon-sb-top"==d.layout?f.append(a.parseHTML(L)).append(a.parseHTML(b)):f.append(a.parseHTML(b)).append(a.parseHTML(L)),f.fadeIn(500),g=f.children(".fpd-sidebar"),h=g.children(".fpd-navigation"),i=g.children(".fpd-content"),l=i.find(".fpd-toolbar"),m=l.children(".fpd-element-buttons"),n=l.children(".fpd-color-picker"),p=l.children(".fpd-patterns-wrapper"),f.hasClass("fpd-horizontal")?(g.css("width",d.dimensions.sidebarHeight),h.find("li").css("line-height",d.dimensions.sidebarNavWidth+"px"),h.css("height",d.dimensions.sidebarNavWidth)):(g.css("height",d.dimensions.sidebarHeight),h.css("width",d.dimensions.sidebarNavWidth),i.css("width",d.dimensions.sidebarContentWidth)),j=f.children(".fpd-product-container").css({width:d.dimensions.productStageWidth}),j.children(".fpd-product-stage").height(d.dimensions.productStageHeight),k=j.children(".fpd-menu-bar"),v=j.append('<div class="fpd-product-loader"><div class="fpd-loading-gif"></div></div>').children(".fpd-product-loader"),f.trigger("templateLoad",[this.url]),setTimeout(M,1e3)})});var M=function(){var b=j.children(".fpd-product-stage").children("canvas").get(0);e=new fabric.Canvas(b,{selection:!1,hoverCursor:"pointer",rotationCursor:"default"}),e.setDimensions({width:d.dimensions.productStageWidth,height:d.dimensions.productStageHeight}),q=j.append('<div class="fpd-modification-tooltip"></div>').children(".fpd-modification-tooltip").tooltipster({offsetY:-3,theme:".fpd-tooltip-theme",delay:0,speed:0,touchDevices:!1}),e.on({"mouse:down":function(a){void 0==a.target&&S()},"text:changed":function(a){E.params.text=a.target.text,T(E)?P():q.tooltipster("hide")},"object:moving":function(a){E.params.x=Math.round(a.target.left),E.params.y=Math.round(a.target.top),T(a.target),E.lockMovementX||(P(d.labels.modificationTooltips.x+Math.round(a.target.left)+d.labels.modificationTooltips.y+Math.round(a.target.top),"moved"),ab(E))},"object:scaling":function(a){E.params.scale=Number(a.target.scaleX).toFixed(2),E.params.x=Math.round(a.target.left),E.params.y=Math.round(a.target.top),a.target.setCoords(),T(a.target),E.lockScalingX||(P(d.labels.modificationTooltips.width+Math.round(E.getWidth())+d.labels.modificationTooltips.height+Math.round(E.getHeight()),"scaled"),ab(E))},"object:rotating":function(a){E.params.degree=Math.round(a.target.angle),T(a.target),E.lockRotation||(P(d.labels.modificationTooltips.angle+Math.round(a.target.angle)%360,"rotated"),ab(E))},"object:selected":function(a){S(!1),E=a.target;var b=E.params;if(ab(E),E.set({borderColor:"white",cornerColor:"transparent",cornerSize:16,rotatingPointOffset:0,padding:7}),i.find(".fpd-elements-dropdown").children('option[value="'+E.id+'"]').prop("selected",!0).parent().trigger("chosen:updated"),Array.isArray(b.colors)&&0!=cb(E)?(n.children("input").val(b.currentColor?b.currentColor:b.colors[0]),b.colors.length>1?n.children("input").spectrum({preferredFormat:"hex",showPaletteOnly:!0,showPalette:!0,palette:b.colors,chooseText:d.labels.colorpicker.change,cancelText:d.labels.colorpicker.cancel,change:function(a){Q(E,a.toHexString())}}):n.children("input").spectrum("destroy").spectrum({preferredFormat:"hex",showInput:!0,chooseText:d.labels.colorpicker.change,cancelText:d.labels.colorpicker.cancel,change:function(a){Q(E,a.toHexString())}}),n.show()):n.hide(),"i-text"==E.type&&(o.children('option[value="'+b.font+'"]').prop("selected","selected").trigger("chosen:updated"),o.parent().show(),l.children(".fpd-customize-text").show(),b.patternable&&p.show()),b.draggable?m.children(".fpd-center-horizontal, .fpd-center-vertical").show():m.children(".fpd-center-horizontal, .fpd-center-vertical").hide(),b.zChangeable?m.children(".fpd-move-down, .fpd-move-up").show():m.children(".fpd-move-down, .fpd-move-up").hide(),b.removable?m.children(".fpd-trash").show():m.children(".fpd-trash").hide(),b.boundingBox&&!d.editorMode)if("object"==typeof b.boundingBox)y=new fabric.Rect({left:b.boundingBox.x,top:b.boundingBox.y,width:b.boundingBox.width,height:b.boundingBox.height,stroke:"blue",strokeWidth:1,fill:!1,selectable:!1,isBoundingRect:!0,originX:"center",originY:"center"}),e.add(y),y.moveTo(e.getObjects().indexOf(E));else for(var c=e.getObjects(),g=0;g<c.length;++g){var j=c[g];if(j.viewIndex==C&&b.boundingBox==j.title&&null==y){y=j,j.stroke="blue",j.strokeWidth=1;break}}e.renderAll(),l.show(),h.find('li[data-target=".fpd-edit-elements"]').click(),T(E),f.trigger("elementSelect",[E])}});for(var c=[],g=0;g<r.length;++g){c=a(r.get(g)).children(".fpd-product"),c.splice(0,0,r.get(g));var t=[];c.each(function(b,c){var d=a(c),e={title:c.title,thumbnail:d.data("thumbnail"),elements:[]};d.children("img,span").each(function(b,c){var d=a(c),f={type:d.is("img")?"image":"text",source:d.is("img")?d.attr("src"):d.text(),title:d.attr("title"),parameters:void 0==d.data("parameters")?{}:d.data("parameters")};e.elements.push(f)}),t.push(e)}),w.addProduct(t)}if(s.size()>0){if(s.children(".fpd-category").length>0)x=i.find(".fpd-designs").prepend('<select class="fpd-design-categories" style="width: 100%;" tabindex="1"></select>').children(".fpd-design-categories").change(function(){var a=G[this.value];i.find(".fpd-designs ul").empty();for(var b=0;b<a.length;++b)fb(a[b])}),s.children(".fpd-category").each(function(b,c){a(c).children("img").each(function(b,d){var e=a(d);w.addDesign(e.attr("src"),e.attr("title"),e.data("parameters"),c.title)})}),d._useChosen&&x.chosen({width:"100%"}),x.change();else for(var z=s.children("img"),g=0;g<z.length;++g)w.addDesign(a(z[g]).attr("src"),z[g].title,a(z[g]).data("parameters"));s.remove()}if(h.find('li[data-target=".fpd-edit-elements"]').show(),d.customTexts){var A=i.children(".fpd-custom-text"),B=A.children("textarea").val();h.find('li[data-target=".fpd-custom-text"]').show(),A.children(".fpd-button-submit").click(function(a){a.preventDefault();var b=A.children("textarea").val();w.addElement("text",b,b,d.customTextParameters,C),A.children("textarea").removeClass("fpd-active").val(B)}),A.children("textarea").focusin(function(){var b=a(this);this.value==B&&(b.addClass("fpd-active"),this.value="")}).focusout(function(){var b=a(this);""==this.value&&(this.value=B,b.removeClass("fpd-active"))})}if(d.uploadDesigns){var H=i.children(".fpd-upload-designs");h.find('li[data-target=".fpd-upload-designs"]').show(),H.children(".fpd-button-submit").click(function(a){a.preventDefault(),H.find(".fpd-input-design").click()}),H.find(".fpd-upload-form").change(function(a){if(window.FileReader){var b=new FileReader,c=a.target.files[0].name;b.readAsDataURL(a.target.files[0]),b.onload=function(a){var b=new Image;b.src=a.target.result,b.onload=function(){var b=this.height,e=this.width;return e>d.customImagesParameters.maxW||e<d.customImagesParameters.minW||b>d.customImagesParameters.maxH||b<d.customImagesParameters.minH?(alert(d.labels.uploadedDesignSizeAlert),!1):(d.customImagesParameters.scale=$(e,b,d.customImagesParameters.resizeToW,d.customImagesParameters.resizeToH),w.addElement("image",a.target.result,c,d.customImagesParameters),void 0)},b.onerror=function(){alert("Image could not be loaded!")}}}else alert("FileReader API is not supported in your browser, please use Firefox, Safari, Chrome or IE10!")})}if(d.facebookAppId&&d.facebookAppId.length>0){var I=i.children(".fpd-fb-user-photos"),J=I.find("select"),K=I.find(".fpd-fb-user-photos-list"),L=I.find(".fpd-loading-gif");h.find('li[data-target=".fpd-fb-user-photos"]').show(),d._useChosen&&J.chosen({width:"100%"});var M=I.find(".fpd-fb-friends-select").change(function(){L.show();var b=a(this).children("option:selected").val();K.empty().css("visibility","hidden"),N.children("option:not(:first)").remove(),FB.api("/"+b+"/albums",function(a){for(var b=a.data,c=0;c<b.length;++c){var d=b[c];N.append('<option value="'+d.id+'">'+d.name+"</option>")}N.trigger("chosen:updated").next(".chosen-container").show(),L.hide()})}),N=I.find(".fpd-fb-user-albums").change(function(){L.show();var b=a(this).children("option:selected").val();K.css("visibility","hidden").empty(),FB.api("/"+b,function(c){var e=c.count;FB.api("/"+b+"?fields=photos.limit("+e+")",function(b){if(!b.error){for(var c=b.photos.data,e=0;e<c.length;++e){var f=c[e],g=f.images[f.images.length-1]?f.images[f.images.length-1].source:f.source;K.append('<li><span class="fpd-loading-gif"></span><img src="'+g+'" title="'+f.id+'" data-picture="'+f.source+'" style="display: none;" /></li>').children("li:last").click(function(b){b.preventDefault(),v.show();var c=a(this).children("img");a.post(d.phpDirectory+"get_image_data_url.php",{url:c.data("picture")},function(a){if(a&&void 0==a.error){var b=new Image;b.src=a.data_url,b.onload=function(){d.customImagesParameters.scale=$(this.width,this.height,d.customImagesParameters.resizeToW,d.customImagesParameters.resizeToH),w.addElement("image",this.src,c.attr("title"),d.customImagesParameters,C)}}else alert(a.error);v.hide()},"json").fail(function(a){v.hide(),alert(a.statusText)})}).children("img").load(function(){a(this).fadeIn(500).prev("span").fadeOut(300,function(){a(this).remove()})}).error(function(){a(this).parent().remove()})}Z(K),K.css("visibility","visible")}L.hide()})})});a.ajaxSetup({cache:!0}),a.getScript("//connect.facebook.net/en_UK/all.js",function(){FB.init({appId:d.facebookAppId,status:!0,cookie:!0,xfbml:!0}),FB.Event.subscribe("auth.statusChange",function(a){"connected"===a.status?(L.show(),FB.api("/me",function(a){M.append('<option value="'+a.id+'">'+a.name+"</option>"),FB.api("/me/friends",function(a){for(var b=a.data.sort(_),c=0;c<b.length;++c){var d=b[c];M.append('<option value="'+d.id+'">'+d.name+"</option>")}M.trigger("chosen:updated").next(".chosen-container").show()}),L.hide()})):(K.empty().css("visibility","hidden"),J.children("option:not(:first)").remove(),J.trigger("chosen:updated").next(".chosen-container").hide())})})}if(d.allowProductSaving&&f.attr("id")){h.find('li[data-target=".fpd-saved-products"]').show(),k.find(".fpd-save-product").click(function(a){a.preventDefault(),S();var b=w.getProduct(!1),c=w.getViewsDataURL()[0],d=U();null==d&&(d=new Array),d.push({thumbnail:c,product:b}),window.localStorage.setItem(f.attr("id"),JSON.stringify(d)),Y(c,b)});var O=U();if(null!=O)for(var g=0;g<O.length;++g){var R=O[g];Y(R.thumbnail,R.product)}}else k.find(".fpd-save-product").parent().hide();if(d.saveAsPdf&&window.jsPDF?k.find(".fpd-save-pdf").click(function(a){a.preventDefault(),S();for(var b=new jsPDF,c=w.getViewsDataURL("jpeg","white"),d=0;d<c.length;++d)b.addImage(c[d],"JPEG",0,0),d<c.length-1&&b.addPage();b.save("Product.pdf")}):k.find(".fpd-save-pdf").parent().hide(),h.find("ul li").click(function(b){b.preventDefault();var c=a(this);if(!c.hasClass("fpd-content-color")){c.parent().children("li").removeClass("fpd-content-color"),c.addClass("fpd-content-color"),i.children("div").hide().children("ul").getNiceScroll().remove();var d=i.children(c.data("target")).show();d.children("ul").size()>0&&Z(d.children("ul"))}}).filter(":visible:first").click(),i.find(".fpd-elements-dropdown").change(function(){if("none"==this.value)S();else for(var a=e.getObjects(),b=0;b<a.length;++b)if(a[b].id==this.value){e.setActiveObject(a[b]);break}}),d.fonts.length>0&&d.fontDropdown){o=l.find(".fpd-fonts-dropdown").change(function(){E.getWidth(),E.setFontFamily(this.value),E.params.font=this.value,bb(this.value),T(E),e.renderAll(),o.trigger("chosen:updated")}),d._useChosen&&o.chosen({width:"100%"}),d.fonts.sort(),0==d.defaultFont&&(d.defaultFont=d.fonts[0]);for(var g=0;g<d.fonts.length;++g)o.append('<option value="'+d.fonts[g]+'" style="font-family: '+d.fonts[g]+';">'+d.fonts[g]+"</option>").trigger("chosen:updated");o.children('option[value="'+d.defaultFont+'"]').prop("selected","selected"),o.parent().show()}if(l.find(".fpd-text-styles").children("button").click(function(b){b.preventDefault();var c=a(this);c.hasClass("fpd-align-left")?(E.setTextAlign("left"),E.params.textAlign="left"):c.hasClass("fpd-align-center")?(E.setTextAlign("center"),E.params.textAlign="center"):c.hasClass("fpd-align-right")?(E.setTextAlign("right"),E.params.textAlign="right"):c.hasClass("fpd-bold")?"bold"==E.getFontStyle()?(E.setFontStyle("normal"),E.params.fontStyle="normal"):(E.setFontStyle("bold"),E.params.fontStyle="bold"):c.hasClass("fpd-italic")&&("italic"==E.getFontStyle()?(E.setFontStyle("normal"),E.params.fontStyle="normal"):(E.setFontStyle("italic"),E.params.fontStyle="italic")),e.renderAll()}),d.patterns&&d.patterns.length>0){for(var g=0;g<d.patterns.length;++g){var V=d.patterns[g];p.children("ul").append('<li><img src="'+V+'" class="" /></li>').children("li:last").click(function(){db(a(this).children("img").attr("src"),E)})}p.children("ul").niceScroll({cursorcolor:"#2E3641"})}m.children(".fpd-center-horizontal, .fpd-center-vertical").click(function(b){b.preventDefault();var c=a(this);W(E,c.hasClass("fpd-center-horizontal"),c.hasClass("fpd-center-vertical"),y?y.getBoundingRect():!1)}),m.children(".fpd-move-down, .fpd-move-up").click(function(b){b.preventDefault();for(var c,d=e.getObjects(),f=null,g=null,h=0;h<d.length;++h)d[h].viewIndex==C&&(null==f&&(f=h),null==g?g=h:g++),d[h]==E&&(c=h);c>g&&(c=g),f>c&&(c=f),a(this).hasClass("fpd-move-down")?c!=f&&E.moveTo(c-1):c!=g&&E.moveTo(c+1)}),m.children(".fpd-reset").click(function(a){if(a.preventDefault(),E){var b=E.params;"i-text"==E.type&&(E.fontSize=b.textSize,E.setText(b.source),E.setFontFamily(b.originFont),E.setTextAlign("left"),E.setFontStyle("normal"),o.children('option[value="'+d.defaultFont+'"]').prop("selected","selected")),E.left=b.originX,E.top=b.originY,E.scaleX=b.originScale,E.scaleY=b.originScale,E.angle=0,b.colors&&b.currentColor!=b.colors[0]&&Q(E,b.colors[0]),T(E),e.renderAll(),b.x=b.originX,b.y=b.originY,b.degree=0,E.params=b}}),m.children(".fpd-trash").click(function(a){a.preventDefault(),0!=E.params.price&&(F-=E.params.price,f.trigger("priceChange",[E.params.price,F])),i.find(".fpd-elements-dropdown").children('option[value="'+E.id+'"]').remove().trigger("chosen:updated"),E.remove(),f.trigger("elementRemove",[E]),S()}),k.find(".fpd-download-image").click(function(){a(this).attr("href",w.getProductDataURL()).attr("download","Product.png")}),k.find(".fpd-print").click(function(a){a.preventDefault(),w.print()}),k.find(".fpd-reset-product").click(function(a){a.preventDefault(),w.loadProduct(D)}),d._useChosen&&i.find(".fpd-elements-dropdown").chosen({width:"100%"}),f.find(".chosen-container").addClass("fpd-border-color"),d.editorMode&&a.post(d.templatesDirectory+"editorbox.php",function(b){f.after(a.parseHTML(b)),u=f.next(".fpd-editor-box")}),f.trigger("ready"),i.find(".fpd-products ul li:first").size()>0?i.find(".fpd-products ul li:first").click():v.hide()},N=function(a){var b=a.params;return("object"==typeof b.colors||b.removable||b.draggable||b.resizable||b.rotatable||b.zChangeable)&&(a.isEditable=a.evented=!0,a.set("selectable",!0),a.viewIndex==C&&i.find(".fpd-elements-dropdown").append('<option value="'+a.id+'">'+a.title+"</option>").trigger("chosen:updated")),d.editorMode?!1:(b.draggable&&(a.lockMovementX=a.lockMovementY=!1),b.rotatable&&(a.lockRotation=!1),b.resizable&&(a.lockScalingX=a.lockScalingY=!1),(b.resizable||b.rotatable)&&(a.hasControls=!0),void 0)},O=function(a,b){function c(){if(e++,e<b.length){var d=b[e];w.addElement(d.type,d.source,d.title,d.parameters,z-1)}else f.off("elementAdded",c),f.trigger("viewCreate",[b,a])}var d=b[0];if(d){var e=0;f.on("elementAdded",c),w.addElement(d.type,d.source,d.title,d.parameters,z-1)}else f.trigger("viewCreate",[b,a])},P=function(a,b){var c=E.left,f=E.top;E.setCoords(),"moved"==b?(c=E.oCoords.tl.x,f=E.oCoords.tl.y):"scaled"==b?(c=E.oCoords.br.x,f=E.oCoords.br.y):(c=E.oCoords.mt.x,f=E.oCoords.mt.y),E.isOut&&(a='"'+E.title+'"'+d.labels.outOfContainmentAlert),q.css({left:c,top:f+k.height()}).tooltipster("reposition").tooltipster("show").tooltipster("update",a),e.on({"mouse:up":function(){q.tooltipster("hide"),e.off("mouseup")}})},Q=function(a,b){if(4==b.length&&(b+=b.substr(1,b.length)),"i-text"==a.type)a.setFill(b),e.renderAll(),a.params.pattern=null;else{var c=cb(a);"png"==c||"dataurl"==c?(a.filters.push(new fabric.Image.filters.Tint({color:b,opacity:1})),a.applyFilters(e.renderAll.bind(e))):"svg"==c&&a.setFill(b)}a.params.currentColor=b,n.children("input").spectrum("set",b),R(a,b),ab(a)},R=function(a,b){if(a.colorControlFor)for(var c=a.colorControlFor,d=0;d<c.length;++d)Q(c[d],b)},S=function(a){a="undefined"==typeof a?!0:a,y&&(y.isBoundingRect&&y.remove(),y.stroke=null,y=null),a&&e.discardActiveObject(),e.renderAll(),i.find(".fpd-elements-dropdown").children("option:first").prop("selected",!0).trigger("chosen:updated"),l.hide().children(".fpd-color-picker, .fpd-fonts-dropdown-wrapper, .fpd-customize-text").hide(),p.hide(),E=null,u&&u.find("i").text("")},T=function(a){if(y){a.setCoords();var b=(a.getBoundingRect(),y.getBoundingRect(),!1),c=a.isOut,b=!a.isContainedWithinRect({x:y.oCoords.tl.x+a.padding,y:y.oCoords.tl.y+a.padding},{x:y.oCoords.br.x-a.padding,y:y.oCoords.br.y-a.padding});return b?(a.borderColor="red",a.opacity=.5,a.isOut=!0):(a.borderColor="white",a.opacity=1,a.isOut=!1),c!=a.isOut&&void 0!=c&&(b?f.trigger("elementOut"):f.trigger("elementIn")),b}return!1},U=function(){return JSON.parse(window.localStorage.getItem(f.attr("id")))},V=function(a){a.params.boundingBox?X(a):W(a,!0,!0,!1),a.params.autoCenter=!1},W=function(a,b,c,d){b&&(d?a.left=d.left+.5*d.width:a.centerH()),c&&(d?a.top=d.top+.5*d.height:a.centerV()),T(a),e.renderAll(),a.setCoords(),a.params.x=a.left,a.params.y=a.top},X=function(a){var b=a.params;if(b.boundingBox){var c;if("object"==typeof b.boundingBox)c={left:b.boundingBox.x-.5*b.boundingBox.width,top:b.boundingBox.y-.5*b.boundingBox.height,width:b.boundingBox.width,height:b.boundingBox.height};else for(var d=e.getObjects(),f=0;f<d.length;++f){var g=d[f];if(g.viewIndex==C&&b.boundingBox==g.title){c=g.getBoundingRect();break}}c&&(W(a,!0,!0,c),a.params.originX=a.left,a.params.originY=a.top)}},Y=function(b,c){var e=i.children(".fpd-saved-products").children("ul");e.append('<li><button><span>&times;</span></button><img src="'+b+'" /></li>').children("li:last").children("img").click(function(b){b.preventDefault(),w.loadProduct(a(this).data("product")),A=-1}).data("product",c).parent().children("button").click(function(b){b.preventDefault();var c=confirm(d.labels.confirmProductDelete);if(!c)return!1;var g=e.children("li").index(a(this).parent("li").remove()),h=U();h.splice(g,1),window.localStorage.setItem(f.attr("id"),JSON.stringify(h))})},Z=function(a){a.height(a.parent().height()-a.position().top-1).niceScroll({cursorcolor:"#2E3641"})},$=function(a,b,c,d){var e=1;return a>b?(a>c&&(e=c/a),e*b>d&&(e=d/b)):(b>d&&(e=d/b),e*a>c&&(e=c/a)),e},_=function(a,b){var c=a.name.toLowerCase(),d=b.name.toLowerCase();return d>c?-1:c>d?1:0},ab=function(a){if(void 0==u)return!1;var b=a.params;u.find(".fpd-current-element").text(a.title),u.find(".fpd-position").text("x: "+b.x+" y: "+b.y),u.find(".fpd-dimensions").text("width: "+Math.round(a.getWidth())+" height: "+Math.round(a.getHeight())),u.find(".fpd-scale").text(Number(b.scale)%360),u.find(".fpd-degree").text(b.degree),u.find(".fpd-color").text(b.currentColor)},bb=function(a){WebFont.load({custom:{families:[a]},fontactive:function(){e.renderAll()}})},cb=function(b){if("i-text"==b.type)return"text";var c=b.source.split(".");return 1==c.length?-1==c[0].search("data:image/png;")?(b.params.currentColor=b.params.colors=!1,!1):"dataurl":-1==a.inArray("png",c)&&-1==a.inArray("svg",c)?(b.params.currentColor=b.params.colors=!1,!1):-1==a.inArray("svg",c)?"png":"svg"},db=function(a,b){"image"==b.type||"i-text"==b.type&&fabric.util.loadImage(a,function(c){b.fill=new fabric.Pattern({source:c,repeat:"repeat"}),e.renderAll(),b.params.pattern=a})},eb=function(a,b){for(var c=e.getObjects(),d=0,f=0;f<c.length;++f){var g=c[f];if(g.visible){if(d==b){a.moveTo(f);break}d++}}},fb=function(b){var c=i.find(".fpd-designs ul");c.append('<li><span class="fpd-loading-gif"></span><img src="'+b.source+'" title="'+b.title+'" style="display: none;" /></li>').children("li:last").click(function(b){b.preventDefault();var c=a(this),d=c.data("parameters");w.addElement("image",c.children("img").attr("src"),c.children("img").attr("title"),d,C)}).data("parameters",b.parameters).children("img").load(function(){a(this).fadeIn(500).prev("span").fadeOut(300,function(){a(this).remove()})}),c.getNiceScroll().resize()};this.getFabricJSON=function(){S();var a=e.toJSON(["viewIndex"]);return a.width=e.width,a.height=e.height,a},this.getPrice=function(){return F},this.getProduct=function(a){a="undefined"!=typeof a?a:!1,S();for(var b=e.getObjects(),c=0;c<b.length;++c){var f=b[c];if(f.isOut)return alert('"'+f.title+'"'+d.labels.outOfContainmentAlert),!1}for(var g=[],c=0;c<D.length;++c){var h=D[c];g.push({title:h.title,thumbnail:h.thumbnail,elements:[]})}for(var c=0;c<b.length;++c){var f=b[c],i={title:f.title,source:f.source,parameters:f.params,type:f.type};a?f.isEditable&&g[f.viewIndex].elements.push(i):g[f.viewIndex].elements.push(i)}return g},this.getViewsDataURL=function(a,b){a="undefined"!=typeof a?a:"png",b="undefined"!=typeof b?b:"transparent",S();var c=[];return e.setBackgroundColor(b,function(){for(var b=e.getObjects(),d=0;z>d;++d){for(var f=0;f<b.length;++f){var g=b[f];g.visible=g.viewIndex==d}c.push(e.toDataURL({format:a}))}for(var d=0;d<b.length;++d){var g=b[d];g.visible=g.viewIndex==C}e.setBackgroundColor("transparent").renderAll()}),c},this.getProductDataURL=function(a,b){a="undefined"!=typeof a?a:"png",b="undefined"!=typeof b?b:"transparent",S(),t.children("li:first").click();var c;return e.setBackgroundColor(b,function(){e.setDimensions({height:d.dimensions.productStageHeight*z});for(var b=e.getObjects(),f=0;f<b.length;++f){var g=b[f];g.visible=!0,g.top=g.top+g.viewIndex*d.dimensions.productStageHeight}c=e.toDataURL({format:a}),e.setDimensions({height:d.dimensions.productStageHeight});for(var f=0;f<b.length;++f){var g=b[f];g.visible=0==g.viewIndex,g.top=g.top-g.viewIndex*d.dimensions.productStageHeight}e.setBackgroundColor("transparent").renderAll()}),c},this.getProductsLength=function(){return i.find(".fpd-products ul li").size()},this.getView=function(){return D[C]},this.getViewDataURL=function(a){return a="undefined"!=typeof a?a:"png",S(),e.toDataURL({format:a})},this.getViewIndex=function(){return C},this.getStage=function(){return e},this.addProduct=function(b){i.find(".fpd-products ul").append('<li><span class="fpd-loading-gif"></span><img src="'+b[0].thumbnail+'" title="'+b[0].title+'" style="display:none;" /></li>').children("li:last").click(function(b){b.preventDefault();var c=a(this),d=i.find(".fpd-products ul li").index(c);w.selectProduct(d)}).data("views",b).children("img").load(function(){a(this).fadeIn(500).prev("span").fadeOut(300,function(){a(this).remove()})}),i.find(".fpd-designs ul").getNiceScroll().resize(),i.find(".fpd-products ul").children("li").length>1&&h.find('li[data-target=".fpd-products"]').show()},this.loadProduct=function(a){function b(){z<D.length?w.addView(D[z]):(f.off("viewCreate",b),f.trigger("productCreate",[B]),v.stop().fadeOut(300))}w.clear(),v.stop().fadeIn(300),D=a,B=D[0].title,j.append('<ul class="fpd-views-selection"></ul>'),f.on("viewCreate",b),w.addView(D[0])},this.selectProduct=function(a){if(a==A)return!1;A=a,0>a?A=0:a>w.getProductsLength()-1&&(A=w.getProductsLength()-1);var b=i.find(".fpd-products ul li").eq(A).data("views");w.loadProduct(b)},this.selectView=function(a){if(a==C)return!1;C=a,0>a?C=0:a>t.children("li").size()-1&&(C=t.children("li").size()-1),S(),i.find(".fpd-elements-dropdown").children('option:not([value="none"])').remove();for(var b=e.getObjects(),c=0;c<b.length;++c){var d=b[c];d.visible=d.viewIndex==C,d.viewIndex==C&&d.isEditable&&i.find(".fpd-elements-dropdown").append('<option value="'+d.id+'">'+d.title+"</option>")}i.find(".fpd-elements-dropdown").trigger("chosen:updated"),e.renderAll()},this.removeProduct=function(a){0>a?a=0:a>w.getProductsLength()-1&&(a=w.getProductsLength()-1),g.children("li").eq(a).remove(),a==A&&(w.clear(),A=-1)},this.addView=function(b){z++,O(b.title,b.elements),t=j.children(".fpd-views-selection"),t.append('<li class="fpd-content-color"><img src="'+b.thumbnail+'" title="'+b.title+'" class="fpd-tooltip" /></li>').children("li:last").click(function(b){b.preventDefault(),w.selectView(t.children("li").index(a(this)))}),a(".fpd-tooltip").tooltipster({offsetY:-3,theme:".fpd-tooltip-theme",touchDevices:!1}),z>1?t.show():t.hide()},this.addElement=function(b,c,g,h,i){if(i="undefined"!=typeof i?i:C,S(),"object"!=typeof h)return alert("The element "+g+" has not a valid JSON object as parameters!"),!1;h=a.extend({},d.elementParameters,h),h.originX=h.x,h.originY=h.y,h.originScale=h.scale,h.source=c;var j=!1,k=null;if(h.colors&&"string"==typeof h.colors)if(0==h.colors.indexOf("#")){var l=h.colors.replace(/\s+/g,"").split(",");h.colors=l}else if(z>1)for(var m=e.getObjects(),n=0;n<m.length;++n){var o=m[n];0==o.viewIndex&&h.colors==o.title&&null==k&&(k=o,j=!0)}var p={source:c,title:g,top:h.y,left:h.x,originX:"center",originY:"center",scaleX:h.scale,scaleY:h.scale,angle:h.degree,id:String((new Date).getTime()),visible:i==C,viewIndex:i,lockUniScaling:!0,lineHeight:1.2};if(d.editorMode?h.removable=h.resizable=h.rotatable=h.zChangeable=!0:a.extend(p,{selectable:!1,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockMovementX:!0,lockMovementY:!0,hasControls:!1,evented:!1}),"image"==b||"path"==b){var q=function(b,c){b.width*c.scale,b.height*c.scale,a.extend(p,{scaleX:c.scale,scaleY:c.scale,params:c,crossOrigin:"anonymous"}),b.set(p),j&&(k.colorControlFor?k.colorControlFor.push(b):(k.colorControlFor=[],k.colorControlFor.push(b))),N(b),e.add(b),c.autoCenter&&V(b),c.currentColor&&Q(b,c.currentColor),c.z!==!1&&eb(b,c.z),f.trigger("elementAdded",[b])},r=c.split(".");-1!=a.inArray("svg",r)?fabric.loadSVGFromURL(c,function(a){a=a[0],q(a,h)}):new fabric.Image.fromURL(c,function(a){q(a,h)})}else{if("text"!=b&&"i-text"!=b)return alert("Sorry. This type of element is not allowed!"),!1;h.text=h.text?h.text:h.source,h.font=h.font?h.font:d.defaultFont,h.fontStyle=h.fontStyle?h.fontStyle:"normal",h.textAlign=h.textAlign?h.textAlign:"left",h.originFont=h.font,a.extend(p,{fontSize:h.textSize,fontFamily:h.font,fontStyle:h.fontStyle,textAlign:h.textAlign,fill:h.colors[0]?h.colors[0]:"#000000",editable:h.textEditable,params:h});var s=new fabric.IText(h.text.replace(/\\n/g,"\n"),p);e.add(s),N(s),h.autoCenter&&V(s),h.currentColor&&Q(s,h.currentColor),h.pattern&&db(h.pattern,s),h.z!==!1&&eb(s,h.z),bb(h.font),f.trigger("elementAdded",[s])}h.price&&(F+=h.price,f.trigger("priceChange",[h.price,F]))},this.addDesign=function(a,b,c,d){null==x?fb({source:a,title:b,parameters:c}):(d="undefined"==typeof d?x.val():d,void 0==G[d]&&(G[d]=new Array,x.append('<option value="'+d+'">'+d+"</option>").trigger("chosen:updated")),G[d].push({source:a,title:b,parameters:c}),x.val()==d&&fb({source:a,title:b,parameters:c})),h.find('li[data-target=".fpd-designs"]').show()
},this.print=function(){var b=new Image;return b.src=w.getProductDataURL(),b.onload=function(){var b=window.open("","","width="+this.width+",height="+this.height+",location=no,menubar=no,scrollbars=yes,status=no,toolbar=no");b.document.title="Print Image",a(b.document.body).append('<img src="'+this.src+'" />'),setTimeout(function(){b.print()},1e3)},!1},this.createImage=function(b,c){"undefined"==typeof b&&(b=!0),"undefined"==typeof c&&(c=!1);var d=w.getProductDataURL(),e=new Image;return e.src=d,e.onload=function(){if(b){var e=window.open("","","width="+this.width+",height="+this.height+",location=no,menubar=no,scrollbars=yes,status=no,toolbar=no");e.document.title="Product Image",a(e.document.body).append('<img src="'+this.src+'" />'),c&&(window.location.href=e.document.getElementsByTagName("img")[0].src.replace("image/png","image/octet-stream"))}f.trigger("imageCreate",[d])},e},this.clear=function(){S(),t&&t.remove(),i.find(".fpd-elements-dropdown").children('option:not([value="none"])').remove(),i.find(".fpd-elements-dropdown").trigger("chosen:updated"),e.clear(),z=C=F=0,D=E=null,f.trigger("stageClear")},fabric.Object.prototype.drawControls=function(a){if(!this.hasControls)return this;var b,c,d=this.cornerSize,e=d/2,f=~~(this.strokeWidth/2),g=-(this.width/2),h=-(this.height/2),i=d/this.scaleX,j=d/this.scaleY,k=this.padding/this.scaleX,l=this.padding/this.scaleY,m=e/this.scaleY,n=e/this.scaleX,o=(e-d)/this.scaleX,p=(e-d)/this.scaleY,q=this.height,r=this.width,s=this.transparentCorners?"strokeRect":"fillRect",t=this.transparentCorners,u="undefined"!=typeof G_vmlCanvasManager;return a.save(),a.lineWidth=1/Math.max(this.scaleX,this.scaleY),a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,a.strokeStyle=a.fillStyle=this.cornerColor,b=g-n-f-k,c=h-m-f-l,u||t||a.clearRect(b,c,i,j),b=g+r-n+f+k,c=h-m-f-l,u||t||a.clearRect(b,c,i,j),b=g-n-f-k,c=h+q+p+f+l,u||t||a.clearRect(b,c,i,j),b=g+r+o+f+k,c=h+q+p+f+l,u||t||a.clearRect(b,c,i,j),this.lockScalingX||(a.drawImage(I,b,c,i,j),a[s](b,c,i,j)),this.get("lockUniScaling")||(b=g+r/2-n,c=h-m-f-l,u||t||a.clearRect(b,c,i,j),a[s](b,c,i,j),b=g+r/2-n,c=h+q+p+f+l,u||t||a.clearRect(b,c,i,j),a[s](b,c,i,j),b=g+r+o+f+k,c=h+q/2-m,u||t||a.clearRect(b,c,i,j),a[s](b,c,i,j),b=g-n-f-k,c=h+q/2-m,u||t||a.clearRect(b,c,i,j),a[s](b,c,i,j)),this.hasRotatingPoint&&!this.lockRotation&&(b=g+r/2-n,c=this.flipY?h+q+this.rotatingPointOffset/this.scaleY-j/2+f+l:h-this.rotatingPointOffset/this.scaleY-j/2-f-l,u||t||a.clearRect(b,c,i,j),a.drawImage(H,b,c,i,j),a[s](b,c,i,j)),a.restore(),this}};jQuery.fn.fancyProductDesigner=function(c){return this.each(function(){var d=a(this);if(!d.data("fancy-product-designer")){var e=new b(this,c);d.data("fancy-product-designer",e)}})},a.fn.fancyProductDesigner.defaults={_useChosen:!0,fontDropdown:!0,fonts:["Arial","Helvetica","Times New Roman","Verdana","Geneva"],customTextParameters:{},customTexts:!0,editorMode:!1,elementParameters:{x:0,y:0,colors:!1,removable:!1,draggable:!1,rotatable:!1,resizable:!1,zChangeable:!1,scale:1,degree:0,price:0,boundingBox:!1,autoCenter:!1,font:!1,textSize:18,patternable:!1,z:!1,textEditable:!0},labels:{outOfContainmentAlert:" is out of his containment!",confirmProductDelete:"Delete saved product?",modificationTooltips:{x:"x: ",y:" y: ",width:"width: ",height:" height: ",angle:"angle: "},colorpicker:{cancel:"Cancel",change:"Change Color"},uploadedDesignSizeAlert:"Sorry! But the uploaded image size does not conform our indication of size.",initText:"Initiliazing product designer..."},allowProductSaving:!0,centerInBoundingbox:!0,templatesDirectory:"templates/",saveAsPdf:!0,uploadDesigns:!0,customImagesParameters:{minW:100,minH:100,maxW:1500,maxH:1500,resizeToW:300,resizeToH:300},defaultFont:!1,dimensions:{sidebarNavWidth:50,sidebarContentWidth:200,sidebarHeight:650,productStageWidth:600,productStageHeight:600},facebookAppId:"",phpDirectory:"php/",patterns:[],layout:"icon-sb-left"}}(jQuery);